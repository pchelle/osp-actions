name: 'Setup Qualification Environment'
description: 'Install OSPSuite tools and Qualification Framework based on csv file input'
author: 'pchelle'

inputs:
  tools-path: 
    description: 'Path a csv file defining the tools and versions to install'
    default: './tools.csv'
  
runs:
  using: "composite"
  steps:
    - id: install-chromehtml2pdf
      name: Install chromehtml2pdf for pdf conversion
      run: |
        npm install -g chromehtml2pdf
      shell: bash
    
    - id: install-pandoc
      name: Install Pandoc for html conversion
      uses: r-lib/actions/setup-pandoc@v2
    
    - id: install-r
      name: Setup R
      uses: r-lib/actions/setup-r@v2
      with:
        r-version: '4.3.1'
        use-public-rspm: true
    
    - id: read-tools
      name: Read and export tools,csv
      run: |
        Rscript -e 'install.packages("jsonlite", repos="https://cloud.r-project.org/")'
        Rscript -e '
        toolsData <- read.csv("${{ inputs.tools-path }}", stringsAsFactors = FALSE, colClasses = "character")
        cat(jsonlite::toJSON(toolsData, dataframe = "rows"))
        ' > tools.json
      shell: bash
        
    - id: tools_data
      name: Output tools data for table conversion      
      run: |
        echo "json=$(cat tools.json)" >> $GITHUB_OUTPUT
      shell: bash
